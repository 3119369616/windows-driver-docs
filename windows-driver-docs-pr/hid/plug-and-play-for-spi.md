---
title: Plug and Play support for HID over SPI
description: Describes Plug and Play support for devices that support HID over SPI.
ms.date: 06/22/2021
ms.localizationpriority: medium
---

# Plug and Play support for HID over SPI

This article describes plug and play support for devices that support HID over the SPI transport.

## Driver Loading

Windows loads the HID SPI class driver based on a compatible identifier match between a hardware identifier and the INF. The identifier is generated by the Advanced Configuration and Power Interface (ACPI). The hardware identifier is generated for the SPI device node in ACPI. All HID SPI compatible devices must expose the compatibility identifier, in addition to a unique hardware identifier.

The ACPI 5.0 Specification includes support for HID Class Devices. the ACPI definitions for HID SPI are as follows.

| Field | Value | ACPI object | Format | Comments |
|--- | --- | ---- | ---- | ---- |
| Hardware ID | Vendor Specific | \_HID | String in the format of VVVVdddd (e.g. MSFT0011) | VendorID + DeviceID |
| Compatible ID | PNP0C51 | \_CID | String in the format of ACPIxxxx or PNPxxxx |CompatibleID |
| Subsystem | Vendor Specific | \_SUB | String in the format of VVVVssss (e.g. MSFQ1234) | SubVendorID + SubSystemID |
| Hardware Revision | Vendor Specific | \_HRV | 0xRRRR (2byte revision) | Hardware revision number |
| Current Resource Settings | Vendor Specific | \_CRS | Byte stream | - SpiSerialBus for access to the device.</br>- GpioInt for interrupts. |
| Device Specific Method | GUID {6e2ac436-0fcf-41af-a265-b32a220dcfab} | \_DSM | Package | Defines a structure that contains device-specific information. |
| Device Reset Method | &nbsp; | \_RST | &nbsp; | ACPI 6.0 7.3.25 compliant device reset method, to be called by the HOST OS as an ACPI FLDR. |

 Every HID SPI device must provide the following mandatory fields:

- Hardware ID
- Compatible ID
- Hardware Revision
- Current Resource Settings
- Device Specific Method

Refer to the Advanced Configuration and Power Interface (ACPI) 6.0 specification for additional information.

The following provides an example of a hardware IDs and compatible IDs for a random HID SPI device. These details are based on a sample device that reports itself as a HID with one top-level collection of class "vendor specific".

Advanced Configuration and Power Interface (ACPI) generates the following Hardware IDs and Compatible IDs to load the HID SPI Transport driver:

**Hardware Identifiers**: Compatible Identifiers

**ACPI\\Vid\_xxxx&Pid\_yyyy&Rev\_zzzz;**: ACPI\\PNP0C51

**ACPI\\Vid\_xxxxPid\_yyyy;**:

**ACPI\\xxxxyyyy;**:

In the previous example, the Hardware ID was generated by using the values extracted from the \_HID ACPI method for the sample device. The Compatible ID is generated by using the values extracted from the \_CID ACPI method for the sample device. The Compatible ID for a HID over SPI must always be PNP0C51 for version 1.0.

> [!NOTE]
> If you supply an INF, you should only use the hardware identifiers in the left column of the previous table. (Do not use the compatible identifier in the right column.)

The Hardware ID for the HID Client device node generated by the HIDClass.sys component is as follows:

**Hardware Identifier**: Compatible Identifier

**HID\\VEN\_MSFT&DEV\_0010&REV\_0002&Col01;**: N/A

**-HID\\VEN\_MSFT&DEV\_0010&Col01 HID\\MSFT0010&Col01;**: N/A

**-HID\\\*MSFT0010Col01**: N/A

**-HID\_DEVICE\_UP:FF00\_U:0001;**: N/A

**-HID\_DEVICE**: N/A

The Hardware ID is generated by HIDClass.sys and is identical for all transports. This identifier is based on values passed to HIDClass.sys from HIDSPI.SYS (extracted from ACPI).

### Device enumeration sequence

Once a HID SPI device driver (HIDSPI.SYS ) is loaded, it starts to communicate with the device over the SPI bus. The first operation the driver performs is the device enumeration sequence.

The following list gives the enumeration sequence. The order of this list may change in future versions of Windows.

1. Retrieve [ACPI Source Language (ASL)](https://uefi.org/htmlspecs/ACPI_Spec_6_4_html/19_ASL_Reference/ACPI_Source_Language_Reference.html?highlight=acpi%20source%20language)  code for HID SPI DEVICE from System BIOS.

1. Retrieve HID Descriptor from the Device.
    - Write HID Descriptor Address
    - Read HID Descriptor

1. Issue a SET\_POWER to the Device.
    - Write SET\_POWER Command

1. Issue a RESET (Host Initiated Reset) to the Device.
    - Write RESET Command
    - Device asserts GPIO interrupt
    - Read value (0x00 0x00) from input register

1. Retrieve report descriptor from the device.
    - Write report descriptor address
    - Read report descriptor

If the HOST fails to successfully complete any of the steps with the DEVICE, the HIDSPI driver may load with error value of *Code 10*. There is no retry logic built into any of these commands.

> [!NOTE]
> Steps 4 and 5 may be done in parallel to optimize for time on SPI. Since report descriptors are (a) static and (b) quite long, Windows may issue a request for 5 while it is waiting for a response from the device on 4.

## Supported HID SPI commands

The host may issue a command to the device in a form of an output report with content type 0x07. The host will set the content ID field of the output report containing the command to the command ID specified in the list below.

There are slightly different semantics to how each command shall be handled by the device. The device shall respond to a command (with the exception of Set Power SLEEP and Set Power OFF) by asserting the interrupt line and making available an input report of content type 0x04, with the content ID field matching the content ID of the command sent by the host.

List of commands and command IDs:

1. 0x00 – Reserved

1. 0x01 – Set Power
    1. Command content (from HOST) shall contain a single byte value:

        1. 0x00 – Reserved

        1. 0x01 – Set power ON

        1. 0x02 – Set power SLEEP

        1. 0x03 – Set power OFF

    1. DEVICE shall respond to a Set Power ON command. DEVICE shall not respond to a Set Power SLEEP, or Set Power OFF command.

    1. Command response content (from DEVICE) shall contain the same single byte value as received from the HOST in the command.

    1. See [Power management over SPI](power-management-over-spi.md) for more information on how power commands are used.

1. 0x02 – 0xEF – Reserved

1. 0xF0 – 0xFF – Reserved for use by platform specific controller implementations

## See also
